{% extends "base.html" %} {% block content %}
<h1>{{name}} ({{ticker}})</h1>
<h2>Current price: {{price}}$</h2>

  
  <form 
  class="mb-3" 
  method="post" 

  id="buyForm" >
  {% csrf_token %}
    <label class="form-label">Quantity</label>
    
    <input
      type="number"
      class="form-control"
      value="{{quantity}}"
      name="quantity"
      id="quantity-input"
      oninput="calculateTotal()"
    />
  
  <h2>Total Price: <span id="total-price"></span></h2>
  <button type="submit" class="btn btn-{{type|yesno:"success,danger"}}">{{type|yesno:"buy,sell"}}</button>
</form>

<script>
  var totalPrice=0
  var price=0
  var quantity=0
  function calculateTotal() {
      price = {{ price }};
      quantity = document.getElementById('quantity-input').value;
      totalPrice = price * quantity;
      document.getElementById('total-price').innerText = totalPrice.toFixed(2)+"$";
  }
 
  let buyForm = document.getElementById("buyForm");

//ALIS KODESTYKKE PIL IKKE

  buyForm.addEventListener("submit", (e) => {
    e.preventDefault();
    const user_balance={{user.balance}};
    const type='{{type}}'=='True'
    if (totalPrice==0){
      alert("Please enter a valid amount!");
    }else if (totalPrice>user_balance){
      alert("Insufficient funds");
    }else{
      console.log("run")
      window.location.assign(`./${quantity}/${type?'buy':'sell'}/${price}/process`);
    }
    

    
  });
  
</script>
{% endblock %}
